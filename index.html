<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>CV Builder</title>
    <!-- Tailwind CSS CDN -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- React & Babel CDNs -->
    <script crossorigin src="https://unpkg.com/react@18/umd/react.development.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <!-- Font Awesome CDN for Icons (added for phone, email, address, and LinkedIn) -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/7.0.0/css/all.min.css" xintegrity="sha512-SnH5WK+bZxgPHs44uWIX+LLMDJd/r0VqLw6GqC5W+WpB2oQ3vB7q+g+uY/14W17+I/uQ/Pz7U11Z4fV2r8vQ==" crossorigin="anonymous" referrerpolicy="no-referrer" />
    <style>
        /* Set default font to Inter */
        html { font-family: 'Inter', sans-serif; }
        /* Print Styles */
        @media print {
            .no-print { display: none !important; }

            /* FIX: Force white background and zero margins on the entire page content */
            html, body {
                background: white !important;
                margin: 0 !important;
                padding: 0 !important;
                min-height: 100vh;
            }

            .cv-preview-container { 
                display: block !important; 
                width: 100% !important; 
                margin: 0 !important; 
                padding: 0 !important;
            }
            
            /* Override the desktop container padding/margins */
            .container { 
                width: 100% !important; 
                max-width: none !important; 
                margin: 0 !important; 
                padding: 0 !important;
            }
            
            /* Remove shadows for clean PDF output */
            .bg-white, .shadow-xl { box-shadow: none !important; }
        }
        /* Toggle Switch Custom Styling */
        .toggle-checkbox {
            transition: transform 0.2s;
        }
        .toggle-checkbox:checked {
            transform: translateX(100%);
        }
    </style>
</head>
<body class="bg-gray-50">
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useCallback, useRef, useEffect, forwardRef } = React;
        const root = ReactDOM.createRoot(document.getElementById('root'));

        // --- Initial CV Data Structure (British context) ---
        const createEmptyExperience = (id) => ({
          id,
          title: '',
          company: '',
          duration: '',
          description: '',
        });

        const createEmptyEducation = (id) => ({
          id,
          institution: '',
          degree: '',
          duration: '',
        });

        const initialCVData = {
          personal: {
            name: 'David Johnson',
            title: 'Qualified Plumber & Heating Engineer',
            email: 'david.johnson.plumbing@example.com',
            phone: '07890 123456',
            linkedin: '', // Removed example LinkedIn for trades context
            // Updated Address fields as requested
            address: 'Guiseley, Leeds LS20 1BG',
            showAddress: true,
            // Existing fields
            showTitle: true,
            showLinkedin: false, // Set to false by default for this persona
          },
          summary: 'Highly skilled and reliable Level 3 Qualified Plumber with 8 years of experience in domestic and light commercial settings. Proficient in boiler installation, fault finding, and complete bathroom refurbishments. Committed to delivering high-quality workmanship and excellent customer service.',
          experience: [
            {
              id: 1,
              title: 'Self-Employed Plumbing Contractor',
              company: 'D. Johnson Plumbing & Heating',
              duration: '2020 - Present',
              description: '• Managed all aspects of a busy independent business, including quoting, scheduling, and billing.\n• Specialised in complete domestic bathroom installations, fitting WCs, baths, showers, and associated pipework.\n• Successfully completed 150+ repair jobs per year, including leaking taps, burst pipes, and drain blockages.',
            },
            {
              id: 2,
              title: 'Maintenance Plumber',
              company: 'Bradford Housing Association',
              duration: '2016 - 2020',
              description: '• Performed routine and emergency plumbing repairs across a portfolio of 300+ residential properties.\n• Carried out annual servicing and basic maintenance on central heating systems.\n• Maintained a 98% first-time fix rate for common issues like boiler pressure loss and radiator failure.',
            },
          ],
          education: [
            {
              id: 1,
              institution: 'Leeds College of Building',
              degree: 'NVQ Level 3 Plumbing and Heating',
              duration: '2014 - 2016',
            },
            {
              id: 2,
              institution: 'Airedale High School',
              degree: 'GCSEs (Maths, English, Science)',
              duration: '2009 - 2014',
            },
          ],
          skills: 'NVQ Level 3 Plumbing, Boiler Service & Repair, Bathroom Fitting, Leak Diagnostics, Pipework Installation (Copper/Plastic), Customer Service, Health & Safety',
        };

        // --- Local Storage Handlers ---
        const LOCAL_STORAGE_KEY = 'cvBuilderData_v1';

        const loadCVData = () => {
            try {
                const storedData = localStorage.getItem(LOCAL_STORAGE_KEY);
                if (storedData) {
                    const parsedData = JSON.parse(storedData);
                    return {
                        ...initialCVData,
                        ...parsedData,
                        personal: { ...initialCVData.personal, ...parsedData.personal },
                    };
                }
            } catch (e) {
                console.error("Error loading from localStorage, using initial data.", e);
            }
            return initialCVData;
        };

        const saveCVData = (data) => {
            try {
                localStorage.setItem(LOCAL_STORAGE_KEY, JSON.stringify(data));
            } catch (e) {
                console.error("Error saving to localStorage.", e);
            }
        };


        // --- Custom Components ---

        const InputField = ({ label, name, value, onChange, type = 'text', fullWidth = false, placeholder = '' }) => (
          <div className={`mb-3 ${fullWidth ? 'col-span-2' : ''}`}>
            <label className="block text-sm font-medium text-gray-700 mb-1">
              {label}
            </label>
            <input
              type={type}
              name={name}
              value={value}
              onChange={onChange}
              placeholder={placeholder}
              className="w-full p-2 border border-gray-300 rounded-lg focus:ring-indigo-500 focus:border-indigo-500 transition duration-150 ease-in-out"
            />
          </div>
        );

        const TextAreaField = ({ label, name, value, onChange, fullWidth = false, rows = 3, placeholder = '' }) => (
          <div className={`mb-3 ${fullWidth ? 'col-span-2' : ''}`}>
            <label className="block text-sm font-medium text-gray-700 mb-1">
              {label}
            </label>
            <textarea
              name={name}
              value={value}
              onChange={onChange}
              rows={rows}
              placeholder={placeholder}
              className="w-full p-2 border border-gray-300 rounded-lg focus:ring-indigo-500 focus:border-indigo-500 transition duration-150 ease-in-out"
            />
          </div>
        );

        const Toggle = ({ label, name, checked, onChange }) => (
          <div className="flex items-center justify-between col-span-2 mb-3 p-3 bg-indigo-50 rounded-lg">
            <label htmlFor={name} className="text-sm font-medium text-gray-700 select-none">
              {label}
            </label>
            <div className="relative inline-block w-10 mr-2 align-middle select-none transition duration-200 ease-in">
              <input
                type="checkbox"
                name={name}
                id={name}
                checked={checked}
                onChange={onChange}
                // Custom styling for the switch
                className={`toggle-checkbox absolute block w-6 h-6 rounded-full bg-white border-4 appearance-none cursor-pointer ${
                  checked ? 'transform translate-x-full border-indigo-600' : 'border-gray-300'
                }`}
                style={{
                  boxShadow: '0 1px 3px 0 rgba(0, 0, 0, 0.1), 0 1px 2px 0 rgba(0, 0, 0, 0.06)',
                }}
              />
              <label
                htmlFor={name}
                className={`toggle-label block overflow-hidden h-6 rounded-full cursor-pointer ${checked ? 'bg-indigo-600' : 'bg-gray-300'}`}
              ></label>
            </div>
          </div>
        );


        // --- CV Preview Component ---

        const CVPreview = forwardRef(({ data }, ref) => {
          const { personal, summary, experience, education, skills } = data;
          const { name, title, email, phone, linkedin, showTitle, showLinkedin, address, showAddress } = personal;

          const SkillPill = ({ skill }) => (
            <span className="inline-block bg-indigo-100 text-indigo-800 text-xs font-semibold px-3 py-1 rounded-full mr-2 mb-2">
              {skill.trim()}
            </span>
          );

          return (
            <div
              ref={ref}
              className="bg-white p-6 md:p-10 shadow-xl min-h-[80vh] w-full"
            >
              {/* Header - Personal Info */}
              <header className="border-b-4 border-indigo-600 pb-2 mb-6">
                <h1 className="text-4xl font-extrabold text-gray-900 mb-1">
                  {name || 'Your Name'}
                </h1>
                {/* Title is shown only if showTitle is true */}
                {showTitle && (
                    <p className="text-xl font-semibold text-indigo-600 mb-2">
                      {title || 'Your Professional Title'}
                    </p>
                )}
                
                {/* Contact Info with Icons and Spacing */}
                <div className="flex flex-wrap text-sm text-gray-600 gap-y-1 gap-x-4">
                  
                  {/* Phone */}
                  <span className="flex items-center space-x-1">
                    <i className="fa-solid fa-square-phone text-indigo-600 text-lg"></i>
                    <span>{phone}</span>
                  </span>
                  
                  {/* Email */}
                  <span className="flex items-center space-x-1">
                    <i className="fa-solid fa-square-envelope text-indigo-600 text-lg"></i>
                    <span>{email}</span>
                  </span>

                  {/* Address (New toggleable field) */}
                  {showAddress && address && (
                    <span className="flex items-center space-x-1">
                      <i className="fa-solid fa-location-dot text-indigo-600 text-lg"></i>
                      <span>{address}</span>
                    </span>
                  )}
                  
                  {/* LinkedIn */}
                  {showLinkedin && linkedin && (
                    <span className="flex items-center space-x-1">
                      <i className="fa-brands fa-square-linkedin text-indigo-600 text-lg"></i>
                      <span className="truncate max-w-[200px]">{linkedin}</span>
                    </span>
                  )}
                </div>
              </header>

              {/* Summary */}
              <section className="mb-6">
                <h2 className="text-lg font-bold uppercase text-indigo-600 border-b border-gray-300 mb-2 pb-1">
                  Professional Summary
                </h2>
                <p className="text-gray-700 leading-relaxed text-sm">
                  {summary || 'A brief summary of your career and professional goals.'}
                </p>
              </section>

              {/* Experience */}
              <section className="mb-6">
                <h2 className="text-lg font-bold uppercase text-indigo-600 border-b border-gray-300 mb-3 pb-1">
                  Work Experience
                </h2>
                {experience.filter(e => e.title || e.company).map((exp, index) => (
                  <div key={exp.id} className={`mb-4 ${index > 0 ? 'mt-4' : ''}`}>
                    <div className="flex justify-between items-start">
                      <h3 className="text-md font-bold text-gray-900">
                        {exp.title || 'Job Title'}
                      </h3>
                      <span className="text-sm text-gray-500 font-medium">
                        {exp.duration || '2020 - Present'}
                      </span>
                    </div>
                    <p className="text-sm text-indigo-600 font-medium italic mb-1">
                      {exp.company || 'Company Name'}
                    </p>
                    <p className="text-xs text-gray-700 whitespace-pre-line">
                      {exp.description || 'Key responsibilities and achievements.'}
                    </p>
                  </div>
                ))}
              </section>

              {/* Education */}
              <section className="mb-6">
                <h2 className="text-lg font-bold uppercase text-indigo-600 border-b border-gray-300 mb-3 pb-1">
                  Education
                </h2>
                {education.filter(e => e.degree || e.institution).map(edu => (
                  <div key={edu.id} className="mb-2">
                    <div className="flex justify-between items-start">
                      <h3 className="text-md font-bold text-gray-900">
                        {edu.degree || 'Degree/Major'}
                      </h3>
                      <span className="text-sm text-gray-500 font-medium">
                        {edu.duration || '2016 - 2020'}
                      </span>
                    </div>
                    <p className="text-sm text-indigo-600 font-medium italic">
                      {edu.institution || 'University Name'}
                    </p>
                  </div>
                ))}
              </section>

              {/* Skills */}
              <section>
                <h2 className="text-lg font-bold uppercase text-indigo-600 border-b border-gray-300 mb-3 pb-1">
                  Skills & Technologies
                </h2 >
                <div className="flex flex-wrap gap-1">
                  {skills
                    .split(',')
                    .filter(s => s.trim().length > 0)
                    .map((skill, index) => (
                      <SkillPill key={index} skill={skill} />
                    ))}
                </div>
              </section>
            </div>
          );
        });

        // --- Main Application Component ---

        function App() {
          const [cvData, setCvData] = useState(loadCVData);
          const previewRef = useRef(null);
          const debounceTimeoutRef = useRef(null);

          const handleSave = useCallback((dataToSave) => {
            
            if (debounceTimeoutRef.current) {
                clearTimeout(debounceTimeoutRef.current);
            }

            debounceTimeoutRef.current = setTimeout(() => {
                saveCVData(dataToSave);
            }, 500);
          }, []);


          // --- Input Handlers ---

          const handlePersonalChange = (e) => {
            const { name, value, type, checked } = e.target;
            const newValue = type === 'checkbox' ? checked : value;

            const newData = {
              ...cvData,
              personal: { ...cvData.personal, [name]: newValue },
            };
            setCvData(newData);
            handleSave(newData);
          };

          const handleSummaryAndSkillsChange = (e) => {
            const { name, value } = e.target;
            const newData = { ...cvData, [name]: value };
            setCvData(newData);
            handleSave(newData);
          };

          const handleArrayChange = (section, id, name, value) => {
            const updatedArray = cvData[section].map((item) =>
              item.id === id ? { ...item, [name]: value } : item
            );
            const newData = { ...cvData, [section]: updatedArray };
            setCvData(newData);
            handleSave(newData);
          };

          const handleAddSection = (section, emptyCreator) => {
            const newId = Date.now() + Math.random();
            const newSection = emptyCreator(newId);
            const newData = {
              ...cvData,
              [section]: [...cvData[section], newSection],
            };
            setCvData(newData);
            handleSave(newData);
          };

          const handleRemoveSection = (section, id) => {
            const updatedArray = cvData[section].filter((item) => item.id !== id);
            const newData = { ...cvData, [section]: updatedArray };
            setCvData(newData);
            handleSave(newData);
          };

          const handlePrint = () => {
            window.print();
          };

          return (
            <div className="min-h-screen bg-gray-50 font-sans">
              <div className="container mx-auto px-4 py-8">
                {/* These are hidden on print using the 'no-print' class */}
                <h1 className="text-3xl font-extrabold text-gray-900 mb-2 no-print">
                  CV Builder
                </h1>
                <p className="text-sm text-gray-600 mb-6 no-print">
                  Create your personal CV for free!
                </p>

                {/* Main Layout: Now using 50/50 split (lg:grid-cols-2) on Desktop */}
                <div className="lg:grid lg:grid-cols-2 lg:gap-8">
                  {/* Input Form - Now lg:col-span-1 for 50% width */}
                  <div className="lg:col-span-1 no-print bg-white p-6 md:p-8 rounded-xl shadow-lg mb-8 lg:mb-0">
                    <div className="flex justify-between items-center mb-6">
                        <h2 className="text-2xl font-bold text-gray-800">Edit Your Details</h2>
                        <div className="relative">
                            <button
                                onClick={handlePrint}
                                className="bg-green-600 hover:bg-green-700 text-white font-bold py-2 px-4 rounded-lg shadow-md transition duration-150 ease-in-out mr-2"
                                aria-label="Print CV"
                            >
                                Print/PDF
                            </button>
                        </div>
                    </div>

                    {/* Personal Information */}
                    <div className="mb-8 border-b pb-4">
                      <h3 className="text-xl font-semibold text-indigo-600 mb-4">
                        Personal Information
                      </h3>
                      <div className="grid grid-cols-1 md:grid-cols-2 gap-4">
                        <InputField
                          label="Full Name"
                          name="name"
                          value={cvData.personal.name}
                          onChange={handlePersonalChange}
                          placeholder="David Johnson"
                        />
                        <InputField
                          label="Email"
                          name="email"
                          type="email"
                          value={cvData.personal.email}
                          onChange={handlePersonalChange}
                          placeholder="your.email@example.com"
                        />
                        <InputField
                          label="Phone Number"
                          name="phone"
                          value={cvData.personal.phone}
                          onChange={handlePersonalChange}
                          placeholder="07890 123456"
                        />
                        
                        {/* Toggle for Professional Title */}
                        <Toggle
                            label="Show Professional Title"
                            name="showTitle"
                            checked={cvData.personal.showTitle}
                            onChange={handlePersonalChange}
                        />
                        {/* Input for Title - only visible when toggle is ON */}
                        {cvData.personal.showTitle && (
                            <InputField
                              label="Professional Title"
                              name="title"
                              value={cvData.personal.title}
                              onChange={handlePersonalChange}
                              placeholder="Qualified Plumber"
                            />
                        )}
                        
                        {/* Toggle for LinkedIn URL */}
                        <Toggle
                            label="Show LinkedIn URL"
                            name="showLinkedin"
                            checked={cvData.personal.showLinkedin}
                            onChange={handlePersonalChange}
                        />
                        {/* Input for LinkedIn - only visible when toggle is ON */}
                        {cvData.personal.showLinkedin && (
                            <InputField
                              label="LinkedIn URL"
                              name="linkedin"
                              value={cvData.personal.linkedin}
                              onChange={handlePersonalChange}
                              placeholder="linkedin.com/in/yourname"
                            />
                        )}
                        
                        {/* Toggle for Address (New) */}
                        <Toggle
                            label="Show Full Address"
                            name="showAddress"
                            checked={cvData.personal.showAddress}
                            onChange={handlePersonalChange}
                        />
                        {/* Input for Address (New) - visible when toggle is ON */}
                        {cvData.personal.showAddress && (
                            <InputField
                              label="Address"
                              name="address"
                              value={cvData.personal.address}
                              onChange={handlePersonalChange}
                              placeholder="Guiseley, Leeds LS20 1BG"
                              fullWidth={true} /* Span across both columns */
                            />
                        )}
                      </div>
                    </div>

                    {/* Summary */}
                    <div className="mb-8 border-b pb-4">
                      <h3 className="text-xl font-semibold text-indigo-600 mb-4">
                        Professional Summary
                      </h3>
                      <TextAreaField
                        label="Summary"
                        name="summary"
                        value={cvData.summary}
                        onChange={handleSummaryAndSkillsChange}
                        rows={4}
                        placeholder="Write a compelling, short paragraph about your career goals and achievements."
                        fullWidth
                      />
                    </div>

                    {/* Work Experience */}
                    <div className="mb-8 border-b pb-4">
                      <h3 className="text-xl font-semibold text-indigo-600 mb-4">
                        Work Experience
                      </h3>
                      {cvData.experience.map((exp) => (
                        <div key={exp.id} className="p-4 mb-4 border border-gray-200 rounded-lg bg-gray-50 relative">
                          <button
                            onClick={() => handleRemoveSection('experience', exp.id)}
                            className="absolute top-2 right-2 text-red-500 hover:text-red-700 font-bold p-1 rounded-full text-lg leading-none"
                            title="Remove Job"
                          >
                            &times;
                          </button>
                          <div className="grid grid-cols-2 gap-4">
                            <InputField
                              label="Job Title"
                              name="title"
                              value={exp.title}
                              onChange={(e) => handleArrayChange('experience', exp.id, e.target.name, e.target.value)}
                              placeholder="e.g., Plumbing Contractor"
                            />
                            <InputField
                              label="Company"
                              name="company"
                              value={exp.company}
                              onChange={(e) => handleArrayChange('experience', exp.id, e.target.name, e.target.value)}
                              placeholder="e.g., D. Johnson Plumbing & Heating"
                            />
                            <InputField
                              label="Duration"
                              name="duration"
                              value={exp.duration}
                              onChange={(e) => handleArrayChange('experience', exp.id, e.target.name, e.target.value)}
                              placeholder="e.g., 2020 - Present"
                            />
                            <div className="col-span-2">
                                <TextAreaField
                                    label="Description (Bullet points recommended)"
                                    name="description"
                                    value={exp.description}
                                    onChange={(e) => handleArrayChange('experience', exp.id, e.target.name, e.target.value)}
                                    rows={4}
                                    placeholder="Use bullet points (e.g., • Managed all aspects of the business; • Specialised in bathroom fitting)"
                                />
                            </div>
                          </div>
                        </div>
                      ))}
                      <button
                        onClick={() => handleAddSection('experience', createEmptyExperience)}
                        className="w-full bg-indigo-100 text-indigo-700 font-semibold py-2 rounded-lg hover:bg-indigo-200 transition duration-150 ease-in-out mt-2"
                      >
                        + Add Experience
                      </button>
                    </div>

                    {/* Education */}
                    <div className="mb-8 border-b pb-4">
                      <h3 className="text-xl font-semibold text-indigo-600 mb-4">
                        Education
                      </h3>
                      {cvData.education.map((edu) => (
                        <div key={edu.id} className="p-4 mb-4 border border-gray-200 rounded-lg bg-gray-50 relative">
                          <button
                            onClick={() => handleRemoveSection('education', edu.id)}
                            className="absolute top-2 right-2 text-red-500 hover:text-red-700 font-bold p-1 rounded-full text-lg leading-none"
                            title="Remove Education"
                          >
                            &times;
                          </button>
                          <div className="grid grid-cols-2 gap-4">
                            <InputField
                              label="Degree/Qualification"
                              name="degree"
                              value={edu.degree}
                              onChange={(e) => handleArrayChange('education', edu.id, e.target.name, e.target.value)}
                              placeholder="e.g., NVQ Level 3 Plumbing"
                            />
                            <InputField
                              label="Institution"
                              name="institution"
                              value={edu.institution}
                              onChange={(e) => handleArrayChange('education', edu.id, e.target.name, e.target.value)}
                              placeholder="e.g., Leeds College of Building"
                            />
                            <InputField
                              label="Duration"
                              name="duration"
                              value={edu.duration}
                              onChange={(e) => handleArrayChange('education', edu.id, e.target.name, e.target.value)}
                              placeholder="e.g., 2014 - 2016"
                              fullWidth
                            />
                          </div>
                        </div>
                      ))}
                      <button
                        onClick={() => handleAddSection('education', createEmptyEducation)}
                        className="w-full bg-indigo-100 text-indigo-700 font-semibold py-2 rounded-lg hover:bg-indigo-200 transition duration-150 ease-in-out mt-2"
                      >
                        + Add Education
                      </button>
                    </div>

                    {/* Skills */}
                    <div className="pb-4">
                      <h3 className="text-xl font-semibold text-indigo-600 mb-4">
                        Skills
                      </h3>
                      <TextAreaField
                        label="Technical Skills (Comma-separated list)"
                        name="skills"
                        value={cvData.skills}
                        onChange={handleSummaryAndSkillsChange}
                        rows={2}
                        placeholder="e.g., NVQ Level 3 Plumbing, Boiler Service & Repair, Bathroom Fitting"
                        fullWidth
                      />
                    </div>

                  </div>

                  {/* CV Preview - Visible on all devices (now 50% width on desktop) */}
                  <div className="lg:col-span-1 cv-preview-container">
                    {/* This H2 is hidden on print using the 'no-print' class */}
                    <h2 className="text-2xl font-bold text-gray-800 mb-4 no-print lg:block hidden">Live Preview</h2>
                    <div className="sticky top-8">
                        <CVPreview data={cvData} ref={previewRef} />
                    </div>
                  </div>
                </div>
              </div>
            </div>
          );
        }
        
        root.render(<App />);
    </script>
</body>
</html>
